<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.xsdq.polaris.repository.dao.UserDao">

    <resultMap id="UserMapping" type="com.xsdq.polaris.repository.po.UserPO">
        <id column="id" property="id" jdbcType="BIGINT" />
        <result column="account" property="account" jdbcType="VARCHAR" />
        <result column="password" property="password" jdbcType="VARCHAR" />
        <result column="nickname" property="nickname" jdbcType="VARBINARY" />
        <result column="status" property="status" jdbcType="TINYINT" />
        <result column="email" property="email" jdbcType="VARCHAR" />
        <result column="phone" property="phone" jdbcType="VARCHAR" />
        <result column="address" property="address" jdbcType="VARCHAR" />
        <result column="avatar_path" property="avatarPath" jdbcType="VARCHAR" />
        <result column="tenant_id" property="tenantId" jdbcType="BIGINT" />
        <result column="create_by" property="createBy" jdbcType="BIGINT" />
        <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
        <result column="update_by" property="updateBy" jdbcType="BIGINT" />
        <result column="update_time" property="updateTime" jdbcType="TIMESTAMP" />
        <association columnPrefix="tenant_" property="tenant" column="tenant_id" javaType="com.xsdq.polaris.repository.po.TenantPO" resultMap="com.xsdq.polaris.repository.dao.TenantDao.TenantMapping"/>
        <collection columnPrefix="role_" property="roles" javaType="com.xsdq.polaris.repository.po.RolePO" resultMap="com.xsdq.polaris.repository.dao.RoleDao.RoleMapping"/>
    </resultMap>

	<select id="findByAccount" resultMap="UserMapping">
        select
            t.id as tenant_id,
            t.name as tenant_name,
            t.description as tenant_description,
            t.status as tenant_status,
            t.logo_path as tenant_logo_path,
            t.address as tenant_address,
            t.contact_info as tenant_contact_info,
            t.create_time as tenant_create_time,
            t.update_time as tenant_update_time,
            u.id,
            u.account,
            u.password,
            u.nickname,
            u.status,
            u.email,
            u.phone,
            u.address,
            u.avatar_path,
            u.tenant_id,
            u.create_by,
            u.create_time,
            u.update_by,
            u.update_time,
            r.id,
            r.name,
            r.entity,
            r.description,
            r.status,
            r.tenant_id,
            r.create_by,
            r.create_time,
            r.update_by,
            r.update_time
        from users u
        left join user_role_relations ur on u.id = ur.user_id
        left join roles r on r.id = ur.role_id
        left join tenants t on u.tenant_id = t.id
        where u.account=#{account}
    </select>

</mapper>
